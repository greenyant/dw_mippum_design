<html ng-app="makingCT">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mippum Edu</title>
    
    <!--editor : wogud86@gmail.com -->
    
    <!-- Bootstrap -->
	<link href="../css/bootstrap.css" rel="stylesheet">
    <script src="../js/jquery-1.11.3.min.js" type="text/javascript"></script>
	<script src="../js/bootstrap.js" type="text/javascript"></script>
    <script src="../js/angular.js"></script>
    <script src="../js/bootstrap-filestyle.js"></script>
    
    <link href="css/making_ct.css" rel="stylesheet">

	<style type="text/css">
	
    </style>
    <script>
        //var model = 
		var model = {
			"name" : "성경",
			"level_label" :  [{ 
				"depth" : 0, 
				"name" : "신구약 구분", 
				"mark" : ["I.", "II."]
			},{ 
				"depth" : 1, 
				"name" : "경서이름", 
				"mark" : "None"
			},{ 
				"depth" : 2, 
				"mark" : "none"
			}],
			
			"contents" : [{ 
				"order" : 0, 
				"name" : "구약성서",
				
				"sub_contents" : [{
					"order" : 0,
					"name" : "창세기",
					
					"sub_contents" : [{
						"order":0,
						"name":"제1장",
					},{
						"order":1,
						"name":"제2장",
					},{
						"order":2,
						"name":"제3장",
					}]
				},{
					"order" : 1,
					"name" : "출애굽기",
					"sub_contents" : [{
						"order":0,
						"name":"제1장",
					},{
						"order":1,
						"name":"제2장",
					}]
				}] 
			},{
				"order" : 1, 
				"name" : "신약성서",
				
				"sub_contents" : [{
					"order" : 0,
					"name" : "마태복음",
					"sub_contents" : [{
						"order":0,
						"name":"제1장",
					},{
						"order":1,
						"name":"제2장",
					}]
				},{
					"order" : 1,
					"name" : "마가복음",
					"sub_contents" : [{
						"order":0,
						"name":"제1장",
					},{
						"order":1,
						"name":"제2장",
					},{
						"order":2,
						"name":"제3장",
					},{
						"order":3,
						"name":"제4장",
					}]
				}] 
			}]
		};
        var mark_types = [ {
                "keyword":"None",//'It has no type.'
                "example":"없음"
            },
            {
                "keyword":"NOOR",//'Not ordered.'
                "example":"직접입력(무순서)"
            },
            {
                "keyword":"BRPO",//'Big Rome letters with a point'
                "example":"I. II. III."
            },
            {
                "keyword":"SRPO",//'Small Rome letters with a point'
                "example":"ⅰ. ⅱ. ⅲ."
            },
            {
                "keyword":"NMPO",//Numbers with a point'
                "example":"1. 2. 3."
            },
            {
                "keyword":"NMAC",//Numbers in a circle
                "example":"① ② ③"
            },
            {
                "keyword":"NMAR",//Numbers with a round bracket
                "example":"1) 2) 3)"
            },
            {
                "keyword":"NMRB",//Numbers in round brackets
                "example":"(1) (2) (3)"
            },
            {
                "keyword":"NMSB",//Numbers in square brackets
                "example":"[1] [2] [3]"
            },
            {
                "keyword":"NMBR",//Numbers in braces
                "example":"{1} {2} {3}"
            },
            {
                "keyword":"KCRB",//Korean Consonant in round brackets
                "example":"㈀㈁㈂"
            },
            {
                "keyword":"KCAC",//Korean Consonant in a circle
                "example":"㉠㉡㉢"
            },
            {
                "keyword":"KLAC",//Korean letter in a circle
                "example":"㉮㉯㉰"
            },
            {
                "keyword":"BEPO",
                "example":"A. B. C."
            },
            {
                "keyword":"BEAR",
                "example":"A) B) C)"
            },
            {
                "keyword":"BERB",
                "example":"(A) (B) (C)"
            },
            {
                "keyword":"SEPO",
                "example":"a. b. c."
            },
            {
                "keyword":"SEAR",
                "example":"a) b) c)"
            },
            {
                "keyword":"SERB",//Small english letter in round brackets
                "example":"(a) (b) (c)"
            },
            {
                "keyword":"SEAC",//Small english letter in a circle
                "example":"ⓐⓑⓒ"
            }];
        
        
        var test_dat;
		var myApp = angular.module("makingCT", []);
		myApp.controller("MakingCTCtrl", function ($scope, $http){
                        
			$scope.ct = model;
            $scope.mark_types = mark_types;
            
			$scope.level_candidates = [1,2,3,4,5,6,7];
			//$scope.level_length = model.level_label.length;
            $scope.select_order = [0];
            $scope.selected_contents = [model.contents];
            var selected_one = model.contents;
            for(var i=0; i<model.level_label.length-1; i++){
                selected_one = selected_one[0].sub_contents;
                $scope.select_order.push(0)
                $scope.selected_contents.push(selected_one);
            }
            $scope.change_ct_select = function (depth){
                
                if(depth < $scope.select_order.length-1){
                    $scope.selected_contents[depth+1] = $scope.selected_contents[depth][Number($scope.select_order[depth])].sub_contents;
                    $scope.change_ct_select(depth+1);
                }
                
            }
            
            $scope.showModal = false;
            $scope.toggleModal = function(){
                $scope.showModal = !$scope.showModal;
            };
            
            $scope.modal_title ="ta";
            $scope.modal_warning_flag = false;
            $scope.submitModal = function(){
                console.log("submit");
            };
            $scope.modal_warning_msg="waring msg";
            
		});
        
        myApp.directive('modal', function () {
            return {
              template: '<div class="modal fade">' + 
                  '<div class="modal-dialog">' + 
                    '<div class="modal-content">' + 
                      '<div class="modal-header">' + 
                        '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>' + 
                        '<h4 class="modal-title">{{ title }}</h4>' + 
                      '</div>' + 
                      '<div class="modal-body" ng-transclude></div>' + 
                    '</div>' + 
                  '</div>' + 
                '</div>',
              restrict: 'E',
              transclude: true,
              replace:true,
              scope:true,
              link: function postLink(scope, element, attrs) {
                scope.title = attrs.title;

                scope.$watch(attrs.visible, function(value){
                  if(value == true)
                    $(element).modal('show');
                  else
                    $(element).modal('hide');
                });

                $(element).on('shown.bs.modal', function(){
                  scope.$apply(function(){
                    scope.$parent[attrs.visible] = true;
                  });
                });

                $(element).on('hidden.bs.modal', function(){
                  scope.$apply(function(){
                    scope.$parent[attrs.visible] = false;
                  });
                });
              }
            };
          });
        
	</script>
</head>
<body ng-controller="MakingCTCtrl">
<nav class="navbar navbar-inverse">

  <div class="container-fluid">
        <div class="navbar-header">
          
          <a class="navbar-brand" href="#">카테고리 만들기</a></div>
        <div class="collapse navbar-collapse" id="inverseNavbar1">
                
        </div>
  </div>
</nav>
<div class="container-fluid">
  <div class="row fst-line">
  	<div class="col-md-5 col-sm-4">
  	 	<input id="input-1" type="file" class="file filestyle" data-buttonText="파일 열기">
     </div>
    <div class="col-md-4 col-sm-4 col-xs-7">
     	<button class="btn btn-default">적용</button>
        <button class="btn btn-default">다운로드</button>
     </div>
     <div class="text-right col-md-3 col-sm-4">
	    <button class="btn btn-danger">변경 내용 저장</button>
     </div>
  </div>
  <div class="row scnd-line">
     <div class="col-md-6 col-sm-6 col-xs-6">
     
         <div class="input-group">
          <span class="input-group-addon" id="ct-name-addon">카테고리 이름</span>
          <input type="text" class="form-control" aria-describedby="ct-name-addon" ng-model="ct.name">
        </div>
     </div>
    <div class="col-md-2">
     	<div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            레벨 수 <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
          	<li ng-repeat="candidate in level_candidates">
            	<a href="#" ng-if="candidate != ct.level_label.length">{{candidate}}</a>
                <b ng-if="candidate == ct.level_label.length">{{candidate}}</b>
            </li>
          </ul>
        </div>
     </div>
  </div>
</div>
    
	<div class="container">
      <div class="row">
          <div ng-repeat="label in ct.level_label"
          	class="col-sm-5 col-md-3 each-ct-set ct-level-{{label.depth}}">
            <div class="row">
            
              <div class="col-md-3 col-sm-3 col-xs-3">분류</div>
              <div class="col-md-8 col-sm-9 col-xs-9">
                  <select>
                    <option ng-if="ct.level_label[label.depth].name!=undefined">{{ct.level_label[label.depth].name}}</option>
                    <option disabled>----------</option>
                  	<option>없음</option>
                    <option>대단원</option>
                    <option>중단원</option>
                    <option>소단원</option>
                    <option>직접입력</option>
                   </select>
              </div>
            </div>
            <div class="row">
           	  <div class="col-md-3 col-sm-3 col-xs-3">부호</div>
              <div class="col-md-8 col-sm-9 col-xs-9">
              	<select>
                    <option disabled>----------</option>
                    <option ng-repeat="mark_type in mark_types" 
                            value="mark_type.keyword">
                        {{mark_type.example}}
                    </option>
                </select>
              </div>
            </div>
            <div class="row">
                <div class="ct-contents col-md-10 col-sm-10 col-xs-10">
                    <select size="5" ng-model="select_order[label.depth]"
                            ng-change="change_ct_select(label.depth)">
                        <option ng-repeat="content in selected_contents[label.depth]"
                                ng-selected="content.order==select_order[label.depth]"
                                value="{{content.order}}">
                            {{ content.name }}
                        </option>
                    </select>
                </div>
                <div class="up-down-arrow col-md-2 col-sm-2 col-xs-1">
                    <div class="btn-group-vertical" role="group" aria-label="Vertical button group">
                      <button type="button" class="btn btn-sm btn-default">
                        <span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span>
                      </button>
                      <button type="button" class="btn btn-sm btn-default">
                        <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                      </button>
                    </div>
                </div>
</div>
            <div class="row">
            	<div class="text-right col-md-10 col-sm-10 col-xs-10">
                    <div class="btn-group" role="group">
                          <button type="button" class="btn btn-default btn-xs">추가</button>
                          <button type="button" class="btn btn-default btn-xs">수정</button>
                          <button type="button" class="btn btn-default btn-xs">삭제</button>
                    </div>
              	</div>
            
          </div>
      </div>
      </div>
</div>
    1{{title}}2
 <button ng-click="toggleModal()" class="btn btn-default">Open modal</button>
    
<modal title="{{modal_title}}" visible="showModal">
    <!--form role="form"-->
    <div class="form-group">
        <span ng-show="modal_warning_flag">{{modal_warning_msg}}</span>
        <input type="email" class="form-control" ng-hide="modal_warning_flag"/>
    </div>
    <div class="text-right">
        <button class="btn" ng-class="{'btn-danger' : modal_warning_flag, 'btn-primary':!modal_warning_flag}" ng-click="submitModal()">확인</button>
        <button type="cancle" class="btn btn-default" data-dismiss="modal">취소</button>
    </div>
    <!--/form-->
</modal>

</body>


</html>